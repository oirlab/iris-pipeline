
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Example pipeline execution &#8212; iris_pipeline v0.4.dev323</title>
    <link rel="stylesheet" href="_static/bootstrap-astropy.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <link rel="shortcut icon" href="_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="IRIS Data Reduction System design" href="design.html" />
    <link rel="prev" title="Getting started" href="getting-started.html" />
    <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,600' rel='stylesheet' type='text/css'/>

  </head><body>
<div class="topbar">
  <a class="brand" title="Documentation Home" href="index.html"><span id="logotext1">iris_pipeline</span><span id="logotext2"></span><span id="logotext3">:docs</span></a>
  <ul>
    
    <li><a class="homelink" title="Astropy Homepage" href="http://www.astropy.org"></a></li>
    <li><a title="General Index" href="genindex.html">Index</a></li>
    <li><a title="Module Index" href="py-modindex.html">Modules</a></li>
    <li>
      
      
<form action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </li>
  </ul>
</div>

<div class="related">
    <h3>Navigation</h3>
    <ul>
      <li class="right">
	<a href="design.html" title="IRIS Data Reduction System design">
	  next &raquo;
	</a>
      </li>
      <li class="right">
	<a href="getting-started.html" title="Getting started">
	  &laquo; previous
	</a>
	 |
      </li>
      <li>
	<a href="index.html">iris_pipeline v0.4.dev323</a>
	 &#187;
      </li>
      
      <li>Example pipeline execution</li> 
    </ul>
</div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            


  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Example-pipeline-execution">
<h1>Example pipeline execution<a class="headerlink" href="#Example-pipeline-execution" title="Permalink to this headline">¶</a></h1>
<p>Here is an example of what it takes to configure and run a pipeline with flat-fielding and background subtraction.</p>
<div class="section" id="Setup-CRDS">
<h2>Setup CRDS<a class="headerlink" href="#Setup-CRDS" title="Permalink to this headline">¶</a></h2>
<p>Make sure you have a local checkout of the CRDS cache as explained in the <a class="reference internal" href="getting-started.html"><span class="doc">Getting started page</span></a>. Run the <code class="docutils literal notranslate"><span class="pre">setup_local_crds.sh</span></code> to setup the enviroment variables needed to point the crds software to the CRDS cache. Optionally source this in your shell configuration to automatically set this up.</p>
</div>
<div class="section" id="Get-input-simulations">
<h2>Get input simulations<a class="headerlink" href="#Get-input-simulations" title="Permalink to this headline">¶</a></h2>
<p>Download simulated input FITS files for the IRIS imager from <a class="reference external" href="https://figshare.com/articles/TMT_IRIS_test_simulations/9941939">Figshare</a>. It contains a raw science frame, a raw flat frame and a raw background frame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">urllib.request</span>

<span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span>
    <span class="s2">&quot;https://ndownloader.figshare.com/articles/9941939/versions/1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iris_example_data.zip&quot;</span>
<span class="p">)</span>

<span class="c1"># this could take a few minutes</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;iris_example_data.zip&#39;, &lt;http.client.HTTPMessage at 0x7f7d5041e550&gt;)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">zipfile</span>
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="s2">&quot;iris_example_data.zip&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
    <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s2">&quot;iris_example_data&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">ls</span> iris_example_data/
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
raw_background_frame_cal.fits  raw_science_frame_sci.fits
raw_flat_frame_cal.fits
</pre></div></div>
</div>
</div>
<div class="section" id="Preprocess-the-flat-frame">
<h2>Preprocess the flat frame<a class="headerlink" href="#Preprocess-the-flat-frame" title="Permalink to this headline">¶</a></h2>
<p>First we need to remove the dark frame from the flat frame and normalize it. A dark frame is already available in the CRDS and the pipeline knows how to retrieve it based on the metadata in the FITS file headers.</p>
<p>We can check in the package documentation what are the available pipelines and check the configuration options of the pipeline.ProcessFlatfieldL2 class.</p>
<p>We do not need to customize it so we can directly call it from tmtrun and pass the input FITS file:</p>
<p>This will pickup the relevant dark frame from the CRDS and process the file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>tmtrun iris_pipeline.pipeline.ProcessFlatfieldL2 iris_example_data/raw_flat_frame_cal.fits
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Traceback (most recent call last):
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/bin/tmtrun&#34;, line 11, in &lt;module&gt;
    load_entry_point(&#39;iris-pipeline==0.4.dev323&#39;, &#39;console_scripts&#39;, &#39;tmtrun&#39;)()
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/pkg_resources/__init__.py&#34;, line 487, in load_entry_point
    return get_distribution(dist).load_entry_point(group, name)
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/pkg_resources/__init__.py&#34;, line 2728, in load_entry_point
    return ep.load()
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/pkg_resources/__init__.py&#34;, line 2346, in load
    return self.resolve()
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/pkg_resources/__init__.py&#34;, line 2352, in resolve
    module = __import__(self.module_name, fromlist=[&#39;__name__&#39;], level=0)
ModuleNotFoundError: No module named &#39;scripts&#39;
</pre></div></div>
</div>
</div>
<div class="section" id="Configure-the-image-processing-pipeline">
<h2>Configure the image processing pipeline<a class="headerlink" href="#Configure-the-image-processing-pipeline" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">`ProcessImagerL2Pipeline</span></code> &lt;api/iris_pipeline.pipeline.ProcessImagerL2Pipeline.rst#iris_pipeline.ProcessImagerL2Pipeline&gt;`__ can be configured using a INI-style configuration file:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>%%file image2_iris.cfg


name = &quot;ProcessImagerL2Pipeline&quot;
class = &quot;iris_pipeline.pipeline.ProcessImagerL2Pipeline&quot;
save_results = True

    [steps]
      [[bkg_subtract]]
      [[assign_wcs]]
        skip = True
      [[flat_field]]
        config_file = flat_field.cfg
      [[photom]]
        skip = True
      [[resample]]
        skip = True
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Writing image2_iris.cfg
</pre></div></div>
</div>
<p>first we specify that we want to execute the pipeline defined in the pipeline, then we can configure each of the steps, for example skip some of them. Also we can import the configuration of a step from another file, in this case flat_field.cfg:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>%%file flat_field.cfg

name = &quot;flat_field&quot;
class = &quot;jwst.flatfield.FlatFieldStep&quot;
override_flat = &#39;raw_flat_frame_flat.fits&#39;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Writing flat_field.cfg
</pre></div></div>
</div>
</div>
<div class="section" id="Define-the-input-data">
<h2>Define the input data<a class="headerlink" href="#Define-the-input-data" title="Permalink to this headline">¶</a></h2>
<p>JWST created a specification for defining how input files should be used by a pipeline, it is a JSON file named an association, see the <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/associations/overview.html">JWST documentation</a>.</p>
<p>In our example we need to specify a input raw science frame ad a background to be subtracted:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%file</span> association.json

<span class="p">{</span>
    <span class="s2">&quot;asn_rule&quot;</span><span class="p">:</span> <span class="s2">&quot;Asn_Lv2Image&quot;</span><span class="p">,</span>
    <span class="s2">&quot;asn_pool&quot;</span><span class="p">:</span> <span class="s2">&quot;pool&quot;</span><span class="p">,</span>
    <span class="s2">&quot;asn_type&quot;</span><span class="p">:</span> <span class="s2">&quot;image2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;products&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_iris_subtract_bg_flat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;members&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;expname&quot;</span><span class="p">:</span> <span class="s2">&quot;iris_example_data/raw_science_frame_sci.fits&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;exptype&quot;</span><span class="p">:</span> <span class="s2">&quot;science&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;expname&quot;</span><span class="p">:</span> <span class="s2">&quot;iris_example_data/raw_background_frame_cal.fits&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;exptype&quot;</span><span class="p">:</span> <span class="s2">&quot;background&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Writing association.json
</pre></div></div>
</div>
</div>
<div class="section" id="Execute-the-pipeline-from-the-command-line">
<h2>Execute the pipeline from the command line<a class="headerlink" href="#Execute-the-pipeline-from-the-command-line" title="Permalink to this headline">¶</a></h2>
<p>Execute the pipeline from the command line We can use tmtrun from a terminal to execute the pipeline:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>tmtrun image2_iris.cfg association.json
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Traceback (most recent call last):
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/bin/tmtrun&#34;, line 11, in &lt;module&gt;
    load_entry_point(&#39;iris-pipeline==0.4.dev323&#39;, &#39;console_scripts&#39;, &#39;tmtrun&#39;)()
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/pkg_resources/__init__.py&#34;, line 487, in load_entry_point
    return get_distribution(dist).load_entry_point(group, name)
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/pkg_resources/__init__.py&#34;, line 2728, in load_entry_point
    return ep.load()
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/pkg_resources/__init__.py&#34;, line 2346, in load
    return self.resolve()
  File &#34;/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/pkg_resources/__init__.py&#34;, line 2352, in resolve
    module = __import__(self.module_name, fromlist=[&#39;__name__&#39;], level=0)
ModuleNotFoundError: No module named &#39;scripts&#39;
</pre></div></div>
</div>
</div>
<div class="section" id="Plot-the-reduced-frame">
<h2>Plot the reduced frame<a class="headerlink" href="#Plot-the-reduced-frame" title="Permalink to this headline">¶</a></h2>
<p>Finally we can use <code class="docutils literal notranslate"><span class="pre">iris_pipeline</span></code> to load the data and plot them:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">iris_pipeline</span>
<span class="n">reduced_science_frame</span> <span class="o">=</span> <span class="n">iris_pipeline</span><span class="o">.</span><span class="n">datamodels</span><span class="o">.</span><span class="n">IRISImageModel</span><span class="p">(</span><span class="s2">&quot;test_iris_subtract_bg_flat_cal.fits&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="o">%</span><span class="k">matplotlib</span> inline
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">reduced_science_frame</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1500</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Processed frame&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-1-3ce251232da6&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">import</span> iris_pipeline
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>reduced_science_frame <span class="ansi-blue-fg">=</span> iris_pipeline<span class="ansi-blue-fg">.</span>datamodels<span class="ansi-blue-fg">.</span>IRISImageModel<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;test_iris_subtract_bg_flat_cal.fits&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>     get_ipython<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>run_line_magic<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;matplotlib&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;inline&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     <span class="ansi-green-fg">import</span> matplotlib<span class="ansi-blue-fg">.</span>pyplot <span class="ansi-green-fg">as</span> plt

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/iris_pipeline-0.4.dev323-py3.6-linux-x86_64.egg/iris_pipeline/datamodels/iris.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, init, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     46</span>     <span class="ansi-green-fg">def</span> __init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> init<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     47</span>
<span class="ansi-green-fg">---&gt; 48</span><span class="ansi-red-fg">         </span>super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>init<span class="ansi-blue-fg">=</span>init<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span>
<span class="ansi-green-intense-fg ansi-bold">     50</span>         <span class="ansi-red-fg"># Implicitly create arrays</span>

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/iris_pipeline-0.4.dev323-py3.6-linux-x86_64.egg/iris_pipeline/datamodels/model_base.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, init, schema, extensions, pass_invalid_values, strict_validation, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     90</span>         super().__init__(init=init, schema=schema, extensions=extensions,
<span class="ansi-green-intense-fg ansi-bold">     91</span>                  pass_invalid_values<span class="ansi-blue-fg">=</span>pass_invalid_values<span class="ansi-blue-fg">,</span> strict_validation<span class="ansi-blue-fg">=</span>strict_validation<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">---&gt; 92</span><span class="ansi-red-fg">                  **kwargs)
</span>
<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/jwst/datamodels/model_base.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, init, schema, memmap, pass_invalid_values, strict_validation, ignore_missing_extensions, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    183</span>                     init_fitsopen <span class="ansi-blue-fg">=</span> init
<span class="ansi-green-intense-fg ansi-bold">    184</span>
<span class="ansi-green-fg">--&gt; 185</span><span class="ansi-red-fg">                 </span>hdulist <span class="ansi-blue-fg">=</span> fits<span class="ansi-blue-fg">.</span>open<span class="ansi-blue-fg">(</span>init_fitsopen<span class="ansi-blue-fg">,</span> memmap<span class="ansi-blue-fg">=</span>memmap<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    186</span>                 asdffile = fits_support.from_fits(
<span class="ansi-green-intense-fg ansi-bold">    187</span>                     hdulist<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_schema<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_ctx<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/astropy/io/fits/hdu/hdulist.py</span> in <span class="ansi-cyan-fg">fitsopen</span><span class="ansi-blue-fg">(name, mode, memmap, save_backup, cache, lazy_load_hdus, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    163</span>
<span class="ansi-green-intense-fg ansi-bold">    164</span>     return HDUList.fromfile(name, mode, memmap, save_backup, cache,
<span class="ansi-green-fg">--&gt; 165</span><span class="ansi-red-fg">                             lazy_load_hdus, **kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">    166</span>
<span class="ansi-green-intense-fg ansi-bold">    167</span>

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/astropy/io/fits/hdu/hdulist.py</span> in <span class="ansi-cyan-fg">fromfile</span><span class="ansi-blue-fg">(cls, fileobj, mode, memmap, save_backup, cache, lazy_load_hdus, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    403</span>         return cls._readfrom(fileobj=fileobj, mode=mode, memmap=memmap,
<span class="ansi-green-intense-fg ansi-bold">    404</span>                              save_backup<span class="ansi-blue-fg">=</span>save_backup<span class="ansi-blue-fg">,</span> cache<span class="ansi-blue-fg">=</span>cache<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 405</span><span class="ansi-red-fg">                              lazy_load_hdus=lazy_load_hdus, **kwargs)
</span><span class="ansi-green-intense-fg ansi-bold">    406</span>
<span class="ansi-green-intense-fg ansi-bold">    407</span>     <span class="ansi-blue-fg">@</span>classmethod

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/astropy/io/fits/hdu/hdulist.py</span> in <span class="ansi-cyan-fg">_readfrom</span><span class="ansi-blue-fg">(cls, fileobj, data, mode, memmap, save_backup, cache, lazy_load_hdus, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">   1052</span>             <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>fileobj<span class="ansi-blue-fg">,</span> _File<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1053</span>                 <span class="ansi-red-fg"># instantiate a FITS file object (ffo)</span>
<span class="ansi-green-fg">-&gt; 1054</span><span class="ansi-red-fg">                 </span>fileobj <span class="ansi-blue-fg">=</span> _File<span class="ansi-blue-fg">(</span>fileobj<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">=</span>mode<span class="ansi-blue-fg">,</span> memmap<span class="ansi-blue-fg">=</span>memmap<span class="ansi-blue-fg">,</span> cache<span class="ansi-blue-fg">=</span>cache<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1055</span>             <span class="ansi-red-fg"># The Astropy mode is determined by the _File initializer if the</span>
<span class="ansi-green-intense-fg ansi-bold">   1056</span>             <span class="ansi-red-fg"># supplied mode was None</span>

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/astropy/utils/decorators.py</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    533</span>                     warnings<span class="ansi-blue-fg">.</span>warn<span class="ansi-blue-fg">(</span>message<span class="ansi-blue-fg">,</span> warning_type<span class="ansi-blue-fg">,</span> stacklevel<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    534</span>
<span class="ansi-green-fg">--&gt; 535</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> function<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    536</span>
<span class="ansi-green-intense-fg ansi-bold">    537</span>         <span class="ansi-green-fg">return</span> wrapper

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/astropy/io/fits/file.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, fileobj, mode, memmap, overwrite, cache)</span>
<span class="ansi-green-intense-fg ansi-bold">    191</span>             self<span class="ansi-blue-fg">.</span>_open_fileobj<span class="ansi-blue-fg">(</span>fileobj<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">,</span> overwrite<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    192</span>         <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>fileobj<span class="ansi-blue-fg">,</span> str<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 193</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_open_filename<span class="ansi-blue-fg">(</span>fileobj<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">,</span> overwrite<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    194</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    195</span>             self<span class="ansi-blue-fg">.</span>_open_filelike<span class="ansi-blue-fg">(</span>fileobj<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">,</span> overwrite<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/astropy/io/fits/file.py</span> in <span class="ansi-cyan-fg">_open_filename</span><span class="ansi-blue-fg">(self, filename, mode, overwrite)</span>
<span class="ansi-green-intense-fg ansi-bold">    572</span>
<span class="ansi-green-intense-fg ansi-bold">    573</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>_try_read_compressed<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>name<span class="ansi-blue-fg">,</span> magic<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">,</span> ext<span class="ansi-blue-fg">=</span>ext<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 574</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_file <span class="ansi-blue-fg">=</span> fileobj_open<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>name<span class="ansi-blue-fg">,</span> IO_FITS_MODES<span class="ansi-blue-fg">[</span>mode<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    575</span>             self<span class="ansi-blue-fg">.</span>close_on_error <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>
<span class="ansi-green-intense-fg ansi-bold">    576</span>

<span class="ansi-green-fg">/opt/hostedtoolcache/Python/3.6.12/x64/lib/python3.6/site-packages/astropy/io/fits/util.py</span> in <span class="ansi-cyan-fg">fileobj_open</span><span class="ansi-blue-fg">(filename, mode)</span>
<span class="ansi-green-intense-fg ansi-bold">    394</span>     &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    395</span>
<span class="ansi-green-fg">--&gt; 396</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> open<span class="ansi-blue-fg">(</span>filename<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">,</span> buffering<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    397</span>
<span class="ansi-green-intense-fg ansi-bold">    398</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;test_iris_subtract_bg_flat_cal.fits&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>



            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3>Releases</h3>
<ul>
  <li><a href="../0.2.0/example-run.html">0.2.0</a></li>
  <li><a href="../0.3.0/example-run.html">0.3.0</a></li>
</ul>
<h3>In Development</h3>
<ul>
  <li><a href="example-run.html">master</a></li>
</ul>


<h3>Page Contents</h3>
<ul>
<li><a class="reference internal" href="#">Example pipeline execution</a><ul>
<li><a class="reference internal" href="#Setup-CRDS">Setup CRDS</a></li>
<li><a class="reference internal" href="#Get-input-simulations">Get input simulations</a></li>
<li><a class="reference internal" href="#Preprocess-the-flat-frame">Preprocess the flat frame</a></li>
<li><a class="reference internal" href="#Configure-the-image-processing-pipeline">Configure the image processing pipeline</a></li>
<li><a class="reference internal" href="#Define-the-input-data">Define the input data</a></li>
<li><a class="reference internal" href="#Execute-the-pipeline-from-the-command-line">Execute the pipeline from the command line</a></li>
<li><a class="reference internal" href="#Plot-the-reduced-frame">Plot the reduced frame</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer class="footer">
  <p class="pull-right">
    <a href="https://github.com/oirlab/iris_pipeline/tree/master/docs/example-run.ipynb">Edit This Page on Github</a> &nbsp;
    <a href="_sources/example-run.ipynb.txt"
       rel="nofollow">Page Source</a> &nbsp;
    <a href="#">Back to Top</a></p>
  <p>
    &copy; Copyright 2020, Andrea Zonca, Arun Surya.<br/>
    Created using <a href="http://www.sphinx-doc.org/en/stable/">Sphinx</a> 3.2.1. &nbsp;
    Last built 09 Oct 2020. <br/>
  </p>
</footer>
  </body>
</html>